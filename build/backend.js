!function(e){var t={};function n(r){if(t[r])return t[r].exports;var i=t[r]={i:r,l:!1,exports:{}};return e[r].call(i.exports,i,i.exports,n),i.l=!0,i.exports}n.m=e,n.c=t,n.d=function(e,t,r){n.o(e,t)||Object.defineProperty(e,t,{configurable:!1,enumerable:!0,get:r})},n.r=function(e){Object.defineProperty(e,"__esModule",{value:!0})},n.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return n.d(t,"a",t),t},n.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},n.p="",n.w={},n(n.s=2)}([function(e,t){e.exports=require("express")},function(e,t,n){"use strict";n.d(t,"a",function(){return i});var r=n(8);const i=n.n(r).a.createLogger({name:"ttt-game-test"})},function(e,t,n){"use strict";n.r(t),n.d(t,"io",function(){return a}),n.d(t,"http",function(){return u});var r=n(12),i=n.n(r),s=n(11),o=n(1);const u=n(14).Server(s.a),a=i()(u);u.listen(process.env.port||3e3,()=>{o.a.warn("Listening on port 3000")})},function(e,t){e.exports=require("lodash")},function(e,t){e.exports=require("mongoose")},function(e,t){e.exports=require("body-parser")},function(e,t){e.exports=require("path")},function(e,t,n){"use strict";var r=n(0),i=n.n(r),s=n(2),o=n(3),u=n.n(o);var a=n(1);const c=i.a.Router();c.get("/",(e,t)=>(s.io.on("connection",e=>{a.a.info("Connected");let t=new class{constructor(e){this._field=[[0,0,0],[0,0,0],[0,0,0]],this._indexOfPlayerToTurn=e,this._turns=[],this._winner=0,this._games=[]}getTurns(){return this._turns}getState(){return{field:this._field,winner:this._winner}}retry(e){return this._winner&&this._games.push({turns:this._turns,winner:this._winner}),this._field=[[0,0,0],[0,0,0],[0,0,0]],this._indexOfPlayerToTurn=e,this._turns=[],this._winner=0,this.getState()}playerTurn({row:e,column:t},n){if(!e||!t||this._indexOfPlayerToTurn!==n||0!==this._field[+e][+t])return;this._field[e][t]=n,this._turns.push({row:e,column:t,player:n}),this._indexOfPlayerToTurn=1===n?2:1;let r=this.isOver();return 0===r&&(this.makeTurnForPlayer(1===n?2:1),r=this.isOver()),this._winner=r,this.getState()}makeTurnForPlayer(e){if(this._indexOfPlayerToTurn!==e)return;let t=this._field.map((e,t)=>e.map((e,t)=>{if(0===e)return t}).map(e=>[t,e]).filter(e=>void 0!==e[0]&&void 0!==e[1])).reduce((e,t)=>e.concat(t),[]);console.log(t);let n=t[Math.round(Math.random()*(t.length-1))];this._field[n[0]][n[1]]=e,this._turns.push({row:n[0],column:n[1],player:e}),this._indexOfPlayerToTurn=2===e?1:2}isOver(){return this.isWinning(1)?1:this.isWinning(2)?2:u.a.flatten(this._field).reduce((e,t)=>0===t?e+1:e,0)?0:-1}isWinning(e){const t=u.a.flatten(this._field);return t[0]===e&&t[1]===e&&t[2]===e||t[3]===e&&t[4]===e&&t[5]===e||t[6]===e&&t[7]===e&&t[8]===e||t[0]===e&&t[3]===e&&t[6]===e||t[1]===e&&t[4]===e&&t[7]===e||t[2]===e&&t[5]===e&&t[8]===e||t[0]===e&&t[4]===e&&t[8]===e||t[2]===e&&t[4]===e&&t[6]===e}}(1);e.emit("connection-status","connected"),e.emit("update-field",t.getState()),e.on("player-turn",n=>{let r=t.playerTurn(n,1);e.emit("update-field",r)}),e.on("retry",()=>{let n=t.retry(1);e.emit("update-field-retry",n)}),e.on("disconnect",()=>{a.a.info("Disconnected"),e.emit("connection-status","Disconnected")})}),t.render("game")));var l=c;const d=i.a.Router();d.get("/",(e,t)=>t.render("index")),d.use("/game",l);t.a=d},function(e,t){e.exports=require("bunyan")},function(e,t){e.exports=require("cookie-parser")},function(e,t){e.exports=require("morgan")},function(e,t,n){"use strict";(function(e){var r=n(0),i=n.n(r),s=n(6),o=n.n(s),u=n(10),a=n.n(u),c=n(9),l=n.n(c),d=n(5),f=n.n(d),h=(n(13),n(7));const p=i()();p.set("views",o.a.join(e,"views")),p.set("view engine","hbs"),p.use(a()("dev")),p.use(f.a.json()),p.use(f.a.urlencoded({extended:!1})),p.use(l()()),p.use(i.a.static(o.a.join(e,"public"))),p.use("/",h.a),p.use(function(e,t,n){const r=new Error("Not Found");r.status=404,n(r)}),p.use(function(e,t,n){n.locals.message=e.message,n.locals.error="development"===t.app.get("env")?e:{},n.status(e.status||500),n.render("error")}),t.a=p}).call(this,"src")},function(e,t){e.exports=require("socket.io")},function(e,t,n){"use strict";var r=n(4),i=n.n(r),s={connectionAddress:"mongodb://localhost:27017/ttt-game"};i.a.Promise=global.Promise;try{i.a.connect(s.connectionAddress)}catch(e){console.log(e)}},function(e,t){e.exports=require("http")}]);
//# sourceMappingURL=backend.js.map