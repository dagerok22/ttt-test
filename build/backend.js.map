{"version":3,"sources":["webpack:///webpack/bootstrap","webpack:///external \"express\"","webpack:///./src/logger.js","webpack:///./src/server.js","webpack:///external \"lodash\"","webpack:///external \"mongoose\"","webpack:///external \"body-parser\"","webpack:///external \"path\"","webpack:///./src/routes/game.js","webpack:///./src/model/Game.js","webpack:///./src/routes/index.js","webpack:///external \"bunyan\"","webpack:///external \"cookie-parser\"","webpack:///external \"morgan\"","webpack:///./src/app.js","webpack:///external \"socket.io\"","webpack:///./src/config.js","webpack:///./src/db/connection.js","webpack:///external \"http\""],"names":["installedModules","__webpack_require__","moduleId","exports","module","i","l","modules","call","m","c","d","name","getter","o","Object","defineProperty","configurable","enumerable","get","r","value","n","__esModule","object","property","prototype","hasOwnProperty","p","w","s","require","logger","a","createLogger","http","Server","_app__WEBPACK_IMPORTED_MODULE_1__","io","socket_io__WEBPACK_IMPORTED_MODULE_0___default","listen","process","env","port","_logger__WEBPACK_IMPORTED_MODULE_2__","warn","game_router","external_express_default","Router","req","res","server","on","socket","info","game","constructor","indexOfPlayerToTurnFirst","this","_field","_indexOfPlayerToTurn","_turns","_winner","_games","getTurns","getState","field","winner","retry","push","turns","playerTurn","row","column","player","isOver","makeTurnForPlayer","availableCells","map","cell","filter","undefined","reduce","b","concat","console","log","Math","round","random","length","isWinning","external_lodash_default","flatten","e","board","emit","cords","result","render","routes_game","routes_router","use","__webpack_exports__","app","express__WEBPACK_IMPORTED_MODULE_0___default","set","path__WEBPACK_IMPORTED_MODULE_1___default","join","__dirname","morgan__WEBPACK_IMPORTED_MODULE_2___default","body_parser__WEBPACK_IMPORTED_MODULE_4___default","json","urlencoded","extended","cookie_parser__WEBPACK_IMPORTED_MODULE_3___default","static","_routes_index__WEBPACK_IMPORTED_MODULE_6__","next","err","Error","status","locals","message","error","config","connectionAddress","external_mongoose_default","Promise","global","connect"],"mappings":"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","file":"backend.js","sourcesContent":[" \t// The module cache\n \tvar installedModules = {};\n\n \t// object to store loaded and loading wasm modules\n \tvar installedWasmModules = {};\n\n \t// The require function\n \tfunction __webpack_require__(moduleId) {\n\n \t\t// Check if module is in cache\n \t\tif(installedModules[moduleId]) {\n \t\t\treturn installedModules[moduleId].exports;\n \t\t}\n \t\t// Create a new module (and put it into the cache)\n \t\tvar module = installedModules[moduleId] = {\n \t\t\ti: moduleId,\n \t\t\tl: false,\n \t\t\texports: {}\n \t\t};\n\n \t\t// Execute the module function\n \t\tmodules[moduleId].call(module.exports, module, module.exports, __webpack_require__);\n\n \t\t// Flag the module as loaded\n \t\tmodule.l = true;\n\n \t\t// Return the exports of the module\n \t\treturn module.exports;\n \t}\n\n\n \t// expose the modules object (__webpack_modules__)\n \t__webpack_require__.m = modules;\n\n \t// expose the module cache\n \t__webpack_require__.c = installedModules;\n\n \t// define getter function for harmony exports\n \t__webpack_require__.d = function(exports, name, getter) {\n \t\tif(!__webpack_require__.o(exports, name)) {\n \t\t\tObject.defineProperty(exports, name, {\n \t\t\t\tconfigurable: false,\n \t\t\t\tenumerable: true,\n \t\t\t\tget: getter\n \t\t\t});\n \t\t}\n \t};\n\n \t// define __esModule on exports\n \t__webpack_require__.r = function(exports) {\n \t\tObject.defineProperty(exports, '__esModule', { value: true });\n \t};\n\n \t// getDefaultExport function for compatibility with non-harmony modules\n \t__webpack_require__.n = function(module) {\n \t\tvar getter = module && module.__esModule ?\n \t\t\tfunction getDefault() { return module['default']; } :\n \t\t\tfunction getModuleExports() { return module; };\n \t\t__webpack_require__.d(getter, 'a', getter);\n \t\treturn getter;\n \t};\n\n \t// Object.prototype.hasOwnProperty.call\n \t__webpack_require__.o = function(object, property) { return Object.prototype.hasOwnProperty.call(object, property); };\n\n \t// __webpack_public_path__\n \t__webpack_require__.p = \"\";\n\n \t// object with all compiled WebAssembly.Modules\n \t__webpack_require__.w = {};\n\n\n \t// Load entry module and return exports\n \treturn __webpack_require__(__webpack_require__.s = 2);\n","module.exports = require(\"express\");","import bunyan from \"bunyan\";\n\nconst logger = bunyan.createLogger({name: 'ttt-game-test'});\n\nexport {logger};","import socketIO from 'socket.io';\nimport app from './app'\nimport {logger} from './logger';\n\nconst http = require('http').Server(app);\nconst io = socketIO(http);\n\nhttp.listen(process.env.port || 3000, () => {\n    logger.warn('Listening on port 3000')\n});\n\nexport {io, http};","module.exports = require(\"lodash\");","module.exports = require(\"mongoose\");","module.exports = require(\"body-parser\");","module.exports = require(\"path\");","import express from 'express';\nimport {io} from '../server';\nimport {Game} from '../model/Game';\nimport {logger} from '../logger';\n\nconst router = express.Router();\n\nrouter.get('/', (req, res) => {\n    io.on('connection', (socket) => {\n        logger.info('Connected');\n        let game = new Game(1);\n        socket.emit('connection-status', 'connected');\n        socket.emit('update-field', game.getState());\n\n        socket.on('player-turn', (cords) => {\n            let result = game.playerTurn(cords, 1);\n            socket.emit('update-field', result);\n        });\n\n        socket.on('retry', () => {\n            let result = game.retry(1);\n            socket.emit('update-field-retry', result);\n        });\n        socket.on('disconnect', () => {\n            logger.info('Disconnected');\n            socket.emit('connection-status', 'Disconnected');\n        });\n    });\n    return res.render('game');\n});\n\nexport default router;\n","import _ from 'lodash';\n\n\nclass Game {\n    constructor(indexOfPlayerToTurnFirst) {\n        this._field = [\n            [0, 0, 0],\n            [0, 0, 0],\n            [0, 0, 0],\n        ];\n        this._indexOfPlayerToTurn = indexOfPlayerToTurnFirst;\n        this._turns = [];\n        this._winner = 0;\n        this._games = [];\n    }\n\n    getTurns() {\n        return this._turns;\n    };\n\n    getState() {\n        return {\n            field: this._field,\n            winner: this._winner,\n        };\n    };\n\n    retry(indexOfPlayerToTurnFirst) {\n        if (this._winner) {\n            this._games.push({\n                turns: this._turns,\n                winner: this._winner,\n            });\n        }\n        this._field = [\n            [0, 0, 0],\n            [0, 0, 0],\n            [0, 0, 0],\n        ];\n        this._indexOfPlayerToTurn = indexOfPlayerToTurnFirst;\n        this._turns = [];\n        this._winner = 0;\n        return this.getState();\n    }\n\n    playerTurn({\n        row,\n        column,\n    }, player) {\n        if (!row || !column || this._indexOfPlayerToTurn !== player || this._field[+row][+column] !== 0) {\n            return;\n        }\n        this._field[row][column] = player;\n        this._turns.push({\n            row,\n            column,\n            player,\n        });\n        this._indexOfPlayerToTurn = player === 1 ? 2 : 1;\n        let winner = this.isOver();\n        if (winner === 0) {\n            this.makeTurnForPlayer(player === 1 ? 2 : 1);\n            winner = this.isOver();\n        }\n        this._winner = winner;\n        return this.getState();\n    }\n\n    makeTurnForPlayer(player) {\n        if (this._indexOfPlayerToTurn !== player) {\n            return;\n        }\n\n        let availableCells = this._field.map((row, i) => {\n            let available = row.map((cell, i) => {\n                if (cell === 0) {\n                    return i;\n                }\n            });\n            return available.map((cell) => [i, cell]).filter((a) => a[0] !== undefined && a[1] !== undefined);\n        }).reduce((a, b) => a.concat(b), []);\n\n        console.log(availableCells);\n        let cell = availableCells[Math.round(Math.random() * (availableCells.length - 1))];\n        this._field[cell[0]][cell[1]] = player;\n        this._turns.push({\n            row: cell[0],\n            column: cell[1],\n            player,\n        });\n        this._indexOfPlayerToTurn = player === 2 ? 1 : 2;\n    }\n\n    isOver() {\n        if (this.isWinning(1)) {\n            return 1;\n        }\n        if (this.isWinning(2)) {\n            return 2;\n        }\n\n        const emptyCells = _.flatten(this._field).reduce((a, e) => e === 0 ? a + 1 : a, 0);\n        if (!emptyCells) {\n            return -1;\n        }\n\n        return 0;\n    }\n\n    isWinning(player) {\n        const board = _.flatten(this._field);\n        return (board[0] === player && board[1] === player && board[2] === player) ||\n            (board[3] === player && board[4] === player && board[5] === player) ||\n            (board[6] === player && board[7] === player && board[8] === player) ||\n            (board[0] === player && board[3] === player && board[6] === player) ||\n            (board[1] === player && board[4] === player && board[7] === player) ||\n            (board[2] === player && board[5] === player && board[8] === player) ||\n            (board[0] === player && board[4] === player && board[8] === player) ||\n            (board[2] === player && board[4] === player && board[6] === player);\n    }\n}\n\nexport {\n    Game,\n};\n","import express from 'express';\nimport game from './game';\n\nconst router = express.Router();\n\nrouter.get('/', (req, res) => res.render('index'));\n\nrouter.use('/game', game);\n\nexport default router;\n","module.exports = require(\"bunyan\");","module.exports = require(\"cookie-parser\");","module.exports = require(\"morgan\");","import express from 'express';\nimport path from 'path';\nimport morgan from 'morgan';\nimport cookieParser from 'cookie-parser';\nimport bodyParser from 'body-parser';\n\nimport connectio from './db/connection';\nimport index from './routes/index';\n\n\nconst app = express();\n\napp.set('views', path.join(__dirname, 'views'));\napp.set('view engine', 'hbs');\n\napp.use(morgan('dev'));\napp.use(bodyParser.json());\napp.use(bodyParser.urlencoded({extended: false}));\napp.use(cookieParser());\napp.use(express.static(path.join(__dirname, 'public')));\n\napp.use('/', index);\n\napp.use(function (req, res, next) {\n    const err = new Error('Not Found');\n    err.status = 404;\n    next(err);\n});\n\napp.use(function (err, req, res) {\n    res.locals.message = err.message;\n    res.locals.error = req.app.get('env') === 'development' ? err : {};\n\n    res.status(err.status || 500);\n    res.render('error');\n});\n\nexport default app;\n","module.exports = require(\"socket.io\");","export default {\n    connectionAddress: `mongodb://localhost:27017/ttt-game`,\n}","import mongoose from 'mongoose';\nimport config from '../config';\n\n\nmongoose.Promise = global.Promise;\ntry {\n    mongoose.connect(config.connectionAddress);\n} catch (error) {\n    console.log(error);\n}\n","module.exports = require(\"http\");"],"sourceRoot":""}